import { Component, OnInit } from '@angular/core';
import { DataService } from '../http-service.service';
import { CommonModule } from '@angular/common';
import { RouterModule, RouterLink, Router, ActivatedRoute } from '@angular/router';
import { environment } from '../environments/environment';

@Component({
  selector: 'app-exploit-view',
  standalone: true,
  imports: [RouterModule, RouterLink, CommonModule],
  templateUrl: './exploit-view.component.html',
  styleUrl: './exploit-view.component.css'
})
export class ExploitViewComponent implements OnInit {
  vulnerability_data: any;
  weakness_data: any;
  threat_data: any;
  exploit_data: any;
  projectID: string = '1';
  componentID: string = '1.1';
  
  
  constructor(private dataService: DataService, private router: Router, private route: ActivatedRoute) { 
    var tmp = this.route.snapshot.params['projectID'];
    this.projectID = '1';
    if(tmp!=null) {
      	this.projectID=tmp;
    }
    tmp = this.route.snapshot.params['componentID'];
    this.componentID = '1.1';
    if(tmp!=null) {
      	this.componentID=tmp;
    }
  }
  
  ngOnInit(): void {
    this.getexploits_view();
  }
  
  getexploits_view(): void {
    var url = environment.apiUrl+'/cti_search/getCVEs?projectID='+this.projectID+'&componentID='+this.componentID;
    this.dataService.getData(url).subscribe({
      next: (response) => {
        this.vulnerability_data = response;
      },
      error: (err) => console.error('Error fetching data:', err)
    });
    
    url = environment.apiUrl+'/cti_search/getCWEs?projectID='+this.projectID+'&componentID='+this.componentID;
    this.dataService.getData(url).subscribe({
      next: (response) => {
        this.weakness_data = response;
      },
      error: (err) => console.error('Error fetching data:', err)
    });
    
    url = environment.apiUrl+'/cti_search/getCAPECs?projectID='+this.projectID+'&componentID='+this.componentID;
    this.dataService.getData(url).subscribe({
      next: (response) => {
        this.threat_data = response;
      },
      error: (err) => console.error('Error fetching data:', err)
    });
    
    url = environment.apiUrl+'/exploit_search/getexploits?projectID='+this.projectID+'&componentID='+this.componentID;
    this.dataService.getData(url).subscribe({
      next: (response) => {
        this.exploit_data = response;
      },
      error: (err) => console.error('Error fetching data:', err)
    });
  }
  
}
